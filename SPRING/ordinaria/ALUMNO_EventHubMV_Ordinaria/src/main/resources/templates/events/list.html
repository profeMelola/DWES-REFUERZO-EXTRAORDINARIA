<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/head :: head('Eventos')}"></head>

<body class="bg-light">
<div th:replace="~{fragments/navbar :: navbar}"></div>

<div class="container py-4">

    <h2 class="mb-3">Eventos</h2>

    <!-- Filtros -->
    <div class="card shadow-sm mb-3">
        <div class="card-body">
            <form method="get" th:action="@{/events}" class="row g-3 align-items-end">

                <!-- al cambiar filtros volvemos a la primera página -->
                <input type="hidden" name="page" value="0"/>

                <!-- Location code (SELECT) -->
                <div class="col-12 col-md-4">
                    <label class="form-label">Ubicación (location)</label>
                    <select name="locationCode" class="form-select">
                        <option value=""
                                th:selected="${locationCode == null || locationCode == ''}">
                            Todas las ubicaciones
                        </option>
                        <option value="MAD_AUDITORIUM" th:selected="${locationCode == 'MAD_AUDITORIUM'}">
                            Madrid – Auditorio Central
                        </option>
                        <option value="MAD_TECH_HALL" th:selected="${locationCode == 'MAD_TECH_HALL'}">
                            Madrid – Tech Hall Gran Vía
                        </option>
                        <option value="BCN_FORUM" th:selected="${locationCode == 'BCN_FORUM'}">
                            Barcelona – Forum
                        </option>
                        <option value="BCN_STAGE" th:selected="${locationCode == 'BCN_STAGE'}">
                            Barcelona – Stage Poblenou
                        </option>
                        <option value="VAL_CONGRESS" th:selected="${locationCode == 'VAL_CONGRESS'}">
                            Valencia – Palacio Congresos
                        </option>
                        <option value="SEV_ARENA" th:selected="${locationCode == 'SEV_ARENA'}">
                            Sevilla – Arena
                        </option>
                    </select>

                </div>

                <!-- Sort field (SELECT) -->
                <div class="col-6 col-md-3">
                    <label class="form-label">Campo de ordenación</label>
                    <select name="sort" class="form-select">
                        <option value="startDateTime" th:selected="${sort == 'startDateTime'}">
                            Fecha de inicio
                        </option>
                        <option value="title" th:selected="${sort == 'title'}">
                            Nombre del evento
                        </option>
                        <option value="category" th:selected="${sort == 'category'}">
                            Categoría
                        </option>
<!--                        <option value="code" th:selected="${sort == 'code'}">-->
<!--                            Event code-->
<!--                        </option>-->
                    </select>
                </div>

                <!-- Direction -->
                <div class="col-6 col-md-2">
                    <label class="form-label">Orden</label>
                    <select name="dir" class="form-select">
                        <option value="asc" th:selected="${dir == 'asc'}">Ascendente</option>
                        <option value="desc" th:selected="${dir == 'desc'}">Descendente</option>
                    </select>
                </div>

                <!-- Size -->
                <div class="col-6 col-md-2">
                    <label class="form-label">Resultados por página</label>
                    <input type="number"
                           name="size"
                           th:value="${size}"
                           min="1"
                           max="50"
                           class="form-control"/>
                </div>

                <!-- Submit -->
                <div class="col-6 col-md-1 d-grid">
                    <button type="submit" class="btn btn-primary">
                        Aplicar
                    </button>
                </div>

            </form>

            <div class="mt-2">
                <a th:href="@{/events}" class="btn btn-link btn-sm p-0">
                    Borrar filtros
                </a>
            </div>
        </div>
    </div>

    <!-- No results -->
    <div th:if="${#lists.isEmpty(events)}" class="alert alert-warning shadow-sm">
        No se han encontrado eventos para el filtro actual
    </div>

    <!-- Results table -->
    <div th:if="${!#lists.isEmpty(events)}" class="card shadow-sm">
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-striped table-hover mb-0">
                    <thead class="table-light">
                    <tr>
                        <th>Nombre</th>
                        <th>Categoría</th>
                        <th>Fecha de inicio</th>
<!--                        <th>Code</th>-->
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="e : ${events}">
                        <td class="fw-semibold">
<!--                            <a th:href="@{|/events/${e.code}|}"-->
<!--                               th:text="${e.title}">-->
<!--                                Event title-->
<!--                            </a>-->
                            <a th:href="@{/events/{code}(code=${e.code})}"
                               th:text="${e.title}">
                                Nombre del evento
                            </a>
                        </td>
                        <td>
                            <span class="badge text-bg-secondary"
                                  th:text="${e.category}">
                                CATEGORÍA
                            </span>
                        </td>
                        <td th:text="${e.startDateTimeFormatted()}">
                            2026-01-01T10:00
                        </td>
<!--                        <td class="text-muted" th:text="${e.code}">-->
<!--                            EVT_CODE-->
<!--                        </td>-->
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="card-footer bg-white">
            <div th:replace="~{fragments/pagination :: pager(
                    '/events',
                    ${page},
                    ${size},
                    ${sort},
                    ${dir},
                    ${locationCode}
            )}"></div>
        </div>
    </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
